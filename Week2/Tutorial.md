# VSDBabySoC – Functional Modelling and Simulation

## Overview

The **VSDBabySoC** is a simple System-on-Chip (SoC) design that integrates three key components:

1.  A RISC-V processor (**`rvmyth`**)
2.  A Phase-Locked Loop (PLL) (**`avsdpll`**)
3.  A Digital-to-Analog Converter (DAC) (**`avsddac`**)

This project focuses on **functional modelling and simulation** of the SoC to verify the integration and analyze the internal signal interactions using Icarus Verilog and GTKWave.

-----

## 🎯 Objective

The primary goal is to build a solid understanding of SoC fundamentals and practice the functional modelling of the BabySoC by simulating the design and analyzing its internal signal interactions to confirm proper operation.

-----

## 🧩 Project Structure

```
VSDBabySoC/
├── src/
│   ├── include/
│   │   └── sandpiper.vh
│   └── module/
│       ├── vsdbabysoc.v      # Top-level SoC integration
│       ├── rvmyth.v          # RISC-V core
│       ├── avsdpll.v         # PLL module
│       ├── avsddac.v         # DAC module
│       └── testbench.v       # Testbench for simulation
├── output/
│   ├── pre_synth_sim/
│   └── post_synth_sim/
└── README.md
```

-----

## ⚙️ Environment Setup

Follow these steps to set up the simulation environment.

### 1\. Clone the Repository

```bash
git clone https://github.com/manili/VSDBabySoC.git
cd VSDBabySoC
```

### 2\. Install Tools

Install the required open-source tools for simulation and waveform viewing:

```bash
sudo apt update
sudo apt install -y iverilog gtkwave
```

-----

## 🧠 Module Descriptions

| Module | Description | Key Inputs/Outputs |
| :--- | :--- | :--- |
| **`vsdbabysoc.v`** | Top-level SoC module integrating the RISC-V core, PLL, and DAC. | **Inputs:** `reset`, PLL control signals (`VCO_IN`, `ENb_CP`, `ENb_VCO`, `REF`), `VREFH`. **Outputs:** `OUT` (analog DAC output), `RV_TO_DAC` (10-bit data bus), `CLK`. |
| **`rvmyth.v`** | Simple **RISC-V processor core** that generates a 10-bit digital output (`OUT`) to feed the DAC. | |
| **`avsdpll.v`** | **Phase-Locked Loop** logic that generates a stable clock (`CLK`) from input reference signals. | |
| **`avsddac.v`** | **Digital-to-Analog Converter** that converts the 10-bit digital signal from the RISC-V core into an analog voltage output. | |
| **`testbench.v`** | Provides stimulus (clock, reset, control signals) to verify BabySoC functionality and generates the **`.vcd`** waveform output for visualization. | |

-----

## 🧪 Simulation Steps

### 1️⃣ Pre-Synthesis (RTL) Simulation

Compile and simulate the BabySoC to generate the waveform file.

```bash
# 1. Create the output directory
mkdir -p output/pre_synth_sim

# 2. Compile the design using Icarus Verilog
iverilog -o output/pre_synth_sim/sim.out -DPRE_SYNTH_SIM \
    -I src/include -I src/module \
    src/module/testbench.v src/module/vsdbabysoc.v

# 3. Run the simulation
cd output/pre_synth_sim
./sim.out
```

### 2️⃣ View the Waveform

After the simulation is complete, the `pre_synth_sim.vcd` file will be generated. Open it with GTKWave:

```bash
gtkwave pre_synth_sim.vcd
```

-----

## 📊 Expected Waveform Observations

When viewing the signals in GTKWave, you should confirm the following:

| Signal | Expected Behavior |
| :--- | :--- |
| **`reset`** | Initially high, then goes low to start processor execution. |
| **`CLK`** | Continuous square wave generated by the PLL. |
| **`RV_TO_DAC[9:0]`** | The processor's 10-bit digital output, changing on each clock cycle as the program executes. |
| **`OUT`** | The DAC’s analog output responding to the digital input. |

**Observation:** You should see a **staircase-like waveform** for the DAC output, indicating successful digital-to-analog conversion and proper module interaction.

-----

## 🧹 Troubleshooting

| Issue | Cause | Fix |
| :--- | :--- | :--- |
| **Module not found** | Missing file path in the compile command. | Use full paths with `-I src/module` and include *all* necessary `.v` files. |
| **Multiple definition** | Duplicate include statements in the design. | Ensure no repeated or conflicting include statements. |
| **No waveform generated** | Missing `$dumpfile` or `$dumpvars` commands in the testbench. | Check `testbench.v` to ensure waveform dumping is correctly initialized. |

-----

## 📚 Reference

  * [VSDBabySoC GitHub Repository](https://github.com/manili/VSDBabySoC)
  * [RVMyth Core](https://www.google.com/search?q=https://github.com/manili/VSDBabySoC/blob/main/src/module/rvmyth.v)
  * [AVSD DAC Interface](https://www.google.com/search?q=https://github.com/manili/VSDBabySoC/blob/main/src/module/avsddac.v)
  * [AVSD PLL Module](https://www.google.com/search?q=https://github.com/manili/VSDBabySoC/blob/main/src/module/avsdpll.v)